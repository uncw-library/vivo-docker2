version: '3.7'

services:
  vivo-solr:
    container_name: vivo-solr
    image: uncwlibrary/vivo-docker2/solr:latest
    platform: linux/amd64
    volumes:
      - solr_data:/var/solr
    restart: unless-stopped

  # vivo-data-update:
  #   container_name: vivo-data-update
  #   image: uncwlibrary/vivo-data-update:latest
  #   env_file: .env
  #   platform: linux/amd64
  #   volumes:
  #     - ./mounted/uploads/file_storage_root/a~n:/output/person_images/a~n
  #     - ./mounted/current_turtle/userdata.ttl:/output/turtles/userdata.ttl
  #   restart: unless-stopped

  vivo-vivo:
    container_name: vivo-vivo
    image: uncwlibrary/vivo-docker2/vivo
    platform: linux/amd64
    volumes:
      - ./mounted/tdbModels:/usr/local/vivo/home/tdbModels
      - ./mounted/tdbContentModels:/tdbContentModels
      - ./mounted/current_turtle/userdata.ttl:/usr/local/vivo/home/rdf/abox/filegraph/userdata.ttl
      - ./mounted/uploads:/usr/local/vivo/home/uploads
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.vivo-vivo.entrypoints=websecure
      - traefik.http.routers.vivo-vivo.rule=Host(`scholars.libapps-dev.uncw.edu`)
      - traefik.http.routers.vivo-vivo.tls=true
      - traefik.http.routers.vivo-vivo.priority=99
      - traefik.http.services.vivo-vivo.loadbalancer.server.port=8080

volumes:
  solr_data:

networks:
  default:
    name: traefik_net
    external: true
