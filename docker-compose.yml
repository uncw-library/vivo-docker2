version: '3.7'

services:
  solr:
    container_name: solr
    image: libapps-admin.uncw.edu:8000/randall-dev/vivo-docker2/solr:latest
    platform: linux/amd64
    volumes:
      - solr_data:/var/solr
    restart: unless-stopped

  vivo-data-update:
    container_name: vivo-data-update
    image: libapps-admin.uncw.edu:8000/randall-dev/vivo-data-update:latest
    env_file: .env
    platform: linux/amd64
    volumes:
      - ./mounted/uploads/file_storage_root/a~n:/output/person_images/a~n
      - ./mounted/current_turtle/userdata.ttl:/output/turtles/userdata.ttl
    restart: unless-stopped

  vivo:
    container_name: vivo-vivo
    image: libapps-admin.uncw.edu:8000/randall-dev/vivo-docker2/vivo:latest
    platform: linux/amd64
    volumes:
      - ./mounted/tdbModels:/usr/local/VIVO/home/tdbModels
      - ./mounted/tdbContentModels:/tdbContentModels
      - ./mounted/current_turtle/userdata.ttl:/usr/local/VIVO/home/rdf/abox/filegraph/userdata.ttl
      - ./mounted/uploads:/usr/local/VIVO/home/uploads
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.vivo.entrypoints=websecure
      - traefik.http.routers.vivo.rule=Host(`scholars.uncw.edu`)
      - traefik.http.routers.vivo.tls=true
      - traefik.http.routers.vivo.priority=99
      - traefik.http.services.vivo.loadbalancer.server.port=8080

volumes:
  solr_data:

networks:
  default:
    name: traefik_net
    external: true
