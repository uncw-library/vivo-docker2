services:
  vivo-solr:
    container_name: vivo-solr
    image: uncwlibrary/vivo-docker2-solr:rwilma
    platform: linux/amd64
    volumes:
      - solr_data:/var/solr
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8983/solr/vivocore/admin/ping || exit 1"]

  # vivo-data-update:
  #   container_name: vivo-data-update
  #   image: uncwlibrary/vivo-data-update:latest
  #   env_file: .env
  #   platform: linux/amd64
  #   volumes:
  #     - ./mounted/uploads/file_storage_root/a~n:/output/person_images/a~n
  #     - ./mounted/current_turtle/userdata.ttl:/output/turtles/userdata.ttl
  #     - ./mounted/incites_store.json:/output/incites_store.json
  #     - ./mounted/wos_starter_store.json:/output/wos_starter_store.json
  #   restart: unless-stopped

  vivo-vivo:
    container_name: vivo-vivo
    image: uncwlibrary/vivo-docker2-vivo:rwilma
    platform: linux/amd64
    volumes:
      - tdbModels:/usr/local/vivo/home/tdbModels
      - tdbContentModels:/tdbContentModels
      - ./mounted/turtles/userdata.ttl:/usr/local/vivo/home/rdf/abox/filegraph/userdata.ttl
      - ./mounted/turtles/featuredFacultyData.ttl:/usr/local/vivo/home/rdf/abox/filegraph/featuredFacultyData.ttl
      - ./mounted/turtles/incites.ttl:/usr/local/vivo/home/rdf/abox/filegraph/incites.ttl
      - ./mounted/turtles/publications_data_backfill.ttl:/usr/local/vivo/home/rdf/abox/filegraph/publications_data_backfill.ttl
      - ./mounted/uploads:/usr/local/vivo/home/uploads
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.vivo-vivo.entrypoints=websecure
      - traefik.http.routers.vivo-vivo.rule=Host(`scholars.libapps-dev.uncw.edu`)
      - traefik.http.routers.vivo-vivo.tls=true
      - traefik.http.routers.vivo-vivo.priority=99
      - traefik.http.services.vivo-vivo.loadbalancer.server.port=8080
    depends_on:
      vivo-solr:
        condition: service_healthy

volumes:
  solr_data:
  tdbModels:
  tdbContentModels:

networks:
  default:
    name: traefik_net
    external: true
